---
title: "[Spring] ìŠ¤í”„ë§ ì…ë¬¸ - 6-1.ìˆœìˆ˜ JDBC"
categories: Spring
toc: true
toc_sticky: true
//author_profile: false ì™¼ìª½ì— ë”°ë¼ë‹¤ë‹ˆëŠ”ê±° í‚¤ê³ ë„ê¸°
layout: single
show_Date: true
date: 2023-12-02
last_modified_at: 2023-12-02
---

<a href="https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8" target="_blank">
  <img src="./../../assets/images/2023-11-23-VLSM/325630-eng.png" alt="325630-eng" style="zoom: 50%;" />
</a>

```
ë³¸ ì‹œë¦¬ì¦ˆëŠ” ì¸í”„ëŸ° ê¹€ì˜í•œë‹˜ì˜
'ìŠ¤í”„ë§ ì…ë¬¸ - ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸, ì›¹ MVC,DB ì ‘ê·¼ ê¸°ìˆ '
ì„ ë³´ê³  ê³µë¶€ìš©ìœ¼ë¡œ ì‘ì„±í•œ ê²ƒì…ë‹ˆë‹¤.
```

<br>

<br>

<br>



# <span style="color: #D6ABFA;">âšªH2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜</span>

## ğŸ”¹ë‹¤ìš´ë¡œë“œ

ê°œë°œì´ë‚˜ í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ê°€ë³ê³  í¸ë¦¬í•œ DBì¸ H2 ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ì„¤ì¹˜í•  ê²ƒì„

[Archive Downloads (h2database.com)](https://www.h2database.com/html/download-archive.html){:target="_blank"}

ìœ„ ë§í¬ì—ì„œ 1.4.200 ë²„ì „ì„ ë‹¤ìš´

![image-20231206222050016](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231206222050016.png)

biní´ë” ì† h2.batì„ ì‹¤í–‰ (ìœˆë„ìš° ê¸°ì¤€)

<br>

![image-20231206222306026](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231206222306026.png)

ì—°ê²° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ 

![image-20231206222525131](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231206222525131.png)

C:\Users\ì‚¬ìš©ìëª… í´ë”ì— test.mv.dbê°€ ìƒì„±ëœë‹¤. 

ì´ë ‡ê²Œ ìµœì´ˆ test.mv.dbíŒŒì¼ì„ ìƒì„±í•œ ì´í›„ë¶€í„°ëŠ” JDBC URLì„ íŒŒì¼ê²½ë¡œ ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì†Œì¼“ì„ í†µí•´ì„œ ì ‘ì†í•˜ë„ë¡ í•´ì¤˜ì•¼ í•¨

ë§Œì•½ ì ‘ì†í•˜ëŠ”ë° ë¬¸ì œê°€ ìˆë‹¤ë©´ ì´ íŒŒì¼ì„ ì§€ìš´ë‹¤ìŒ ë‹¤ì‹œ h2.batì„ ì‹¤í–‰

<br>

![image-20231206222739407](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231206222739407.png)

ìœ„ì™€ê°™ì´ JDBC URLì„ **jdbc:h2:tcp://localhost/~/test** ìœ¼ë¡œ ì ì–´ì¤˜ì„œ ì†Œì¼“ì„ í†µí•´ì„œ ì ‘ì†í•˜ê²Œ ì„¤ì •í•´ì¤Œ

(ì´ë ‡ê²Œ í•´ì•¼ ì—¬ëŸ¬êµ°ë°ì—ì„œ ì ‘ì†í•  ìˆ˜ ìˆë‹¤ê³  í•¨)

## ğŸ”¹í…Œì´ë¸” ìƒì„±

```sql
drop table if exists member CASCADE;
create table member
(
 id bigint generated by default as identity,
 name varchar(255),
 primary key (id)
);
```

generated by default as identityë¥¼ ì¨ì¤¬ì„ë•Œ idë¥¼ ì…ë ¥í•˜ì§€ì•Šê³  insertë¥¼ í•˜ë©´ 

dbê°€ ìë™ìœ¼ë¡œ ì´ì „ idì—ì„œ 1ì¦ê°€ì‹œì¼œì„œ ë„£ì–´ì¤Œ

![image-20231206223853067](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231206223853067.png)

<br>

![image-20231206225144717](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231206225144717.png)

ì´ëŸ°ì‹ìœ¼ë¡œ sqlí´ë”ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ddlë¬¸ì„ ì ì–´ì£¼ë©´ ê¹ƒìœ¼ë¡œ ê´€ë¦¬ê°€ ë˜ê¸° ë•Œë¬¸ì— í•´ë†“ìœ¼ë©´ ì¢‹ìŒ

<br>

<br>

<br>

# <span style="color: #D6ABFA;">âšªìˆœìˆ˜ Jdbc</span>

ìˆœìˆ˜ jdbcë¥¼ ì‚¬ìš©í•œ ê°œë°œì„ ìš”ì¦˜ì€ í•˜ì§€ ì•ŠìŒ

ê·¸ëŸ¬ë‚˜ ì•Œì•„ë‘ë©´ ì¢‹ê¸° ë•Œë¬¸ì— ì§„í–‰

## ğŸ”¹í™˜ê²½ ì„¤ì •

### ğŸ”¸build.gradle  ì„¤ì •

build.gradleíŒŒì¼ì— jdbcì™€ h2 ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ëŠ” ê³¼ì •

![image-20231206225939794](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231206225939794.png)

```java
	implementation ("org.springframework.boot:spring-boot-starter-jdbc")
        //ìë°”ëŠ” DBë‘ ë¶™ìœ¼ë ¤ë©´ jdbcë“œë¼ì´ë²„ê°€ í•„ìš”í•¨
        
	runtimeOnly ("com.h2database:h2")
        //dbë‘ ë¶™ì„ë•Œ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”í•¨. ì´ ê²½ìš°ì—” h2 ë°ì´í„°ë² ì´ìŠ¤ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©
```

### ğŸ”¸application.properties ì„¤ì •

```properties
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
```

> **ì£¼ì˜!** 
>
> ìŠ¤í”„ë§ë¶€íŠ¸ 2.4ë¶€í„°ëŠ” spring.datasource.username=sa ë¥¼ ê¼­ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤. 
>
> ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Wrong user name or password ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. 

## ğŸ”¹Jdbc íšŒì› ë¦¬í¬ì§€í† ë¦¬

```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;
import org.springframework.jdbc.datasource.DataSourceUtils;

import javax.sql.DataSource;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

public class JdbcMemberRepository implements MemberRepository {

    private final DataSource dataSource;

    public JdbcMemberRepository(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    @Override
    public Member save(Member member) {
        String sql = "insert into member(name) values(?)";

        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
            
            pstmt.setString(1, member.getName());
            
            pstmt.executeUpdate(); //insertë¬¸ì´ê¸° ë•Œë¬¸ì— excuteUpdate()
            rs = pstmt.getGeneratedKeys();
            
            if (rs.next()) {
                member.setId(rs.getLong(1));
            } else {
                throw new SQLException("id ì¡°íšŒ ì‹¤íŒ¨");
            }
            return member;
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs); //ìì›ë“¤ release í•´ì¤˜ì•¼í•¨. dbì»¤ë„¥ì…˜ ê°™ì€ê±´ íŠ¹íˆ ë°˜í™˜ì•ˆí•˜ê³  ìŒ“ì´ë©´ í°ì¼ ë‚¨
        }
    }

    @Override
    public Optional<Member> findById(Long id) {

        String sql = "select * from member where id = ?";

        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);
            pstmt.setLong(1, id);

            rs = pstmt.executeQuery(); //ì¡°íšŒëŠ” excuteQuery()ì„

            if(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                return Optional.of(member);
            } else {
                return Optional.empty();
            }

        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }

    }

    @Override
    public List<Member> findAll() {
        String sql = "select * from member";

        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);

            rs = pstmt.executeQuery();

            List<Member> members = new ArrayList<>();
            while(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                members.add(member);
            }

            return members;
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }

    @Override
    public Optional<Member> findByName(String name) {
        String sql = "select * from member where name = ?";

        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);
            pstmt.setString(1, name);

            rs = pstmt.executeQuery();

            if(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                return Optional.of(member);
            }

            return Optional.empty();
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }

    private Connection getConnection() {
        return DataSourceUtils.getConnection(dataSource); 
        //ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ ì“¸ë•ŒëŠ” connectì„ ê¼­ DataSourceUtilsë¥¼ í™œìš©í•´ì„œ ê°€ì ¸ì™€ì•¼ í•¨
    }

    private void close(Connection conn, PreparedStatement pstmt, ResultSet rs) {
        try {
            if (rs != null) {
                rs.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        try {
            if (pstmt != null) {
                pstmt.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        try {
            if (conn != null) {
                close(conn);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    private void close(Connection conn) throws SQLException {
        DataSourceUtils.releaseConnection(conn, dataSource);
    }
}
```

## ğŸ”¹ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½

```java
package hello.hellospring;

import hello.hellospring.repository.JdbcMemberRepository;
import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import hello.hellospring.service.MemberService;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
public class SpringConfig {
    private final DataSource dataSource;

    public SpringConfig(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository());
    }

    @Bean
    public MemberRepository memberRepository() {
        // return new MemoryMemberRepository(); ì´ì œ ì´ê±° ì•ˆì”€
        return new JdbcMemberRepository(dataSource);
    }
}
```

> DataSourceëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ì„ íšë“í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°ì²´ë‹¤. 
>
> ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ DataSourceë¥¼ ìƒì„±í•˜ê³  ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë§Œë“¤ì–´ë‘”ë‹¤. 
>
> ê·¸ë˜ì„œ DIë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

# <span style="color: #D6ABFA;">âšªí˜„ì¬ ì»¨í…Œì´ë„ˆ ìƒíƒœ</span>

## ğŸ”¹êµ¬í˜„ í´ë˜ìŠ¤ ì¶”ê°€í•œ ìƒí™©

![image-20231207055941986](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231207055941986.png)

JdbcMemberRepositoryë¥¼ ì´ë²ˆì— ì¶”ê°€í•˜ì˜€ìŒ

## ğŸ”¹ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒí™©

![image-20231207060011094](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231207060011094.png)

![image-20231207060138398](./../../assets/images/2023-12-02-SpringPureJdbc/image-20231207060138398.png)

ìŠ¤í”„ë§ ì„¤ì •ì—ì„œ ìœ„ì²˜ëŸ¼ ë³€ê²½í•˜ì˜€ìŒ

- ê°œë°©-íì‡„ ì›ì¹™(OCP, Open-Closed Principle)
  - í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³ , ìˆ˜ì •, ë³€ê²½ì—ëŠ” ë‹«í˜€ìˆë‹¤
- ìŠ¤í”„ë§ì˜ DI(Dependencies Injection)ì„ ì‚¬ìš©í•˜ë©´ ê¸°ì¡´ ì½”ë“œë¥¼ ì „í˜€ ì†ëŒ€ì§€ ì•Šê³ , ì„¤ì •ë§Œìœ¼ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤
- ë°ì´í„°ë¥¼ DBì— ì €ì¥í•˜ë¯€ë¡œ ìŠ¤í”„ë§ ì„œë²„ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ë„ ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì–´ ìˆìŒ
